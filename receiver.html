<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>مطبخ شيخ البلد</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Cairo'; background: #1a1a1a; color: white; margin: 0; padding: 20px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
        .order-box { background: #333; border: 2px solid #ffe755; border-radius: 15px; padding: 20px; position: relative; }
        .item { font-size: 1.2rem; border-bottom: 1px solid #444; padding: 5px 0; }
        .btn-done { background: #27ae60; color: white; border: none; padding: 15px; width: 100%; border-radius: 10px; font-weight: bold; font-size: 1.1rem; cursor: pointer; margin-top: 15px; }
        .time { color: #ffe755; font-size: 0.8rem; }
    </style>
</head>
<body>

    <h1 style="text-align:center; color:#ffe755;">شاشة المطبخ - الطلبات الجارية</h1>
    <div class="grid" id="kitchenGrid"></div>

    <audio id="alertSound" src="https://assets.mixkit.co/active_storage/sfx/995/995-preview.mp3"></audio>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, onValue, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCYrGDMzUuQ1MiHmCy2OPId8yG07DyRT_g",
            authDomain: "sheikh-of-the-country.firebaseapp.com",
            projectId: "sheikh-of-the-country",
            storageBucket: "sheikh-of-the-country.firebasestorage.app",
            messagingSenderId: "767891906712",
            appId: "1:767891906712:web:1ee97ae642db1eb77b70ed",
            measurementId: "G-PLL1LDBRM1"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        onValue(ref(db, 'orders'), (s) => {
            const grid = document.getElementById('kitchenGrid');
            const data = s.val();
            grid.innerHTML = '';
            let newOrderFound = false;

            if(!data) return;

            Object.entries(data).forEach(([id, o]) => {
                if(o.status === 'processing') {
                    grid.innerHTML += `
                        <div class="order-box">
                            <div class="time">${new Date(o.timestamp).toLocaleTimeString('ar-EG')}</div>
                            <h3>${o.customerName}</h3>
                            <div>${o.items.map(i => `<div class="item">● ${i.name} (${i.variant.bread})</div>`).join('')}</div>
                            <button class="btn-done" onclick="finishOrder('${id}')">تم التحضير ✅</button>
                        </div>`;
                }
                if(o.status === 'pending') newOrderFound = true;
            });

            if(newOrderFound) document.getElementById('alertSound').play();
        });

        window.finishOrder = (id) => update(ref(db, `orders/${id}`), { status: 'completed' });
    </script>
</body>
</html>
